<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quiz da Tabuada</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/iniciar_jogo/iniciar.css') }}">
  <link rel="icon" href="{{ url_for('static', filename='imagens/logo.png') }}" type="image/png">
</head>

<body>
  <!-- 🎵 Música de fundo (landing) -->
  <audio id="bgmusic" preload="auto" loop playsinline>
    <source src="{{ url_for('static', filename='audio/musica.mp3') }}" type="audio/mpeg">
  </audio>
  <!-- 🔊 Botão mute/desmute -->
  <button id="toggleMute" class="botao-mudo" aria-label="Alternar som">🔇</button>

  <!-- 🔔 Overlay para solicitar toque (se autoplay com som for bloqueado) -->
  <div id="soundGate" class="sound-gate">
    <div class="sound-card">
      <h3>Ativar som?</h3>
      <p>Tocamos uma trilha de fundo para deixar o jogo mais divertido.</p>
      <div style="display:flex; gap:8px; justify-content:center; flex-wrap:wrap;">
        <button id="enableSound" class="sound-cta">🔊 Tocar música</button>
        <button id="enterMuted" class="sound-cta secondary">❌ Cancelar</button>
      </div>
    </div>
  </div>
  <div>
    <div class="main-wrap page">
      <div class="card">
        <h1>Bem Vindo</h1>
        <h1>🎯 Quiz da Tabuada 🎯</h1>

        <button id="iniciar">Iniciar Jogo</button>
        <button id="installButton" style="
  position: fixed;
  bottom: 20px;
  right: 20px;
  background-color: #3b82f6;
  color: white;
  border: none;
  border-radius: 50px;
  padding: 14px 20px;
  font-size: 16px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.3);
  cursor: pointer;
  display: none;
  z-index: 9999;
">
          📲 Baixar App
        </button>
        <div class="arrow">⬆️</div>
      </div>
    </div>
    <button class="btn-manual" id="manualBtn">📖 Manual</button>
  </div>
  <!-- 📖 Botão flutuante Manual -->


  <div class="botao-nuvem">
    <div class="btn-duvida" id="btnDuvida">?</div>
    <div class="nuvem-texto" id="praticar">Vamos Praticar?</div>

  </div>
  <!-- BOTÃO DE INSTALAÇÃO -->


  <script>
    let deferredPrompt;
    const installButton = document.getElementById('installButton');

    // ✅ Detecta se é iPhone/iPad (Safari)
    const isIOS = /iphone|ipad|ipod/i.test(navigator.userAgent);
    const isInStandalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone === true;

    // --- Caso seja iPhone, mostra mensagem personalizada ---
    if (isIOS && !isInStandalone) {
      const msg = document.createElement('div');
      msg.innerHTML = `
    👉 Para instalar este app:<br>
    <b>1.</b> Toque em <b>Compartilhar</b> (ícone com seta ⬆️)<br>
    <b>2.</b> Escolha <b>"Adicionar à Tela de Início"</b>
  `;
      msg.style = `
    position: fixed;
    bottom: 20px;
    left: 10px;
    right: 10px;
    background: #151528;
    color: white;
    border-radius: 14px;
    padding: 12px;
    text-align: center;
    font-size: 15px;
    box-shadow: 0 3px 8px rgba(0,0,0,0.4);
    z-index: 9999;
  `;
      document.body.appendChild(msg);
    }

    // --- Caso seja Android ou Desktop ---
    window.addEventListener('beforeinstallprompt', (e) => {
      console.log('📲 beforeinstallprompt detectado!');
      e.preventDefault();
      deferredPrompt = e;
      installButton.style.display = 'block'; // mostra botão
    });

    // Quando o usuário clicar no botão
    installButton.addEventListener('click', async () => {
      installButton.style.display = 'none';
      if (deferredPrompt) {
        deferredPrompt.prompt();
        const { outcome } = await deferredPrompt.userChoice;
        console.log('Resultado da instalação:', outcome);
        deferredPrompt = null;
      }
    });

    // Some automaticamente quando o app for instalado
    window.addEventListener('appinstalled', () => {
      console.log('✅ App instalado!');
      installButton.style.display = 'none';
      localStorage.setItem('pwa_installed', 'true');
    });

    // Esconde o botão se já estiver instalado
    if (localStorage.getItem('pwa_installed') === 'true' || isInStandalone) {
      installButton.style.display = 'none';
    }
  </script>


  <script src="static/js/iniciar.js"></script>
</body>

</html>